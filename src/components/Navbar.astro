---
import '../styles/tailwind.css';
const base = import.meta.env.BASE_URL || '/';

---
<nav class="border-b border-slate-100 bg-white/80 backdrop-blur-md sticky top-0 z-50">
    <div class="container mx-auto px-6 py-6 flex justify-between items-center">

        <!-- Logo -->
        <a href={`${base}`} class="text-xl font-black tracking-tighter text-blue-900">
            UAII <span class="text-slate-400 font-light">Urban AI Institute</span>
        </a>

        <!-- Desktop Menu -->
        <div class="hidden md:flex gap-6 text-xs font-bold uppercase tracking-widest text-slate-500">
            <a href="#about" class="hover:text-blue-600">About</a>
            <a href={`${base}people`} class="hover:text-blue-600">People</a>
            <a href={`${base}projects`} class="hover:text-blue-600">Projects</a>
            <a href={`${base}events`} class="hover:text-blue-600">Events</a>
            <a href={`${base}apply`} class="hover:text-blue-600">Apply</a>
        </div>
        
        <!-- Mobile Menu Button -->
        <button id="menuBtn"
                class="md:hidden text-slate-700 focus:outline-none"
                aria-label="Open menu">
            ☰
        </button>
    </div>

    <!-- Mobile Menu -->
    <div id="mobileMenu"
         class="hidden md:hidden bg-white border-t border-slate-100">
        <div class="flex flex-col px-6 py-4 gap-4 text-sm font-semibold text-slate-700">
            <a href="#about">About</a>
            <a href={`${base}people`}>People</a>
            <a href={`${base}projects`}>Projects</a>
            <a href={`${base}apply`}>Apply</a>
            <a href={`${base}press`}>Press</a>
        </div>
    </div>
</nav>
<script>
    // dropdowns: open ONLY on click (desktop + mobile)
const dropdowns = document.querySelectorAll('.dropdown') as NodeListOf<HTMLElement>;

function closeAll(except: HTMLElement | null = null) {
    dropdowns.forEach(d => {
        if (d !== except) {
            const btn = d.querySelector('.dropbtn') as HTMLElement;
            const panel = d.querySelector('.dropdown-menu') as HTMLElement;
            if (panel) panel.hidden = true;                 // force hidden
            if (btn) btn.setAttribute('aria-expanded', 'false');
        }
    });
}

// ensure all panels start hidden
closeAll();

dropdowns.forEach((d: HTMLElement) => {
    const btn = d.querySelector('.dropbtn') as HTMLElement;
    const panel = d.querySelector('.dropdown-menu') as HTMLElement;
    if (!btn || !panel) return;

    btn.addEventListener('click', (e) => {
        e.preventDefault();
        const willOpen = panel.hidden;                    // open if currently hidden
        closeAll(d);                                      // close others
        (panel as HTMLElement).hidden = !willOpen;                         // toggle
        btn.setAttribute('aria-expanded', String(willOpen));
    });
});

// click outside to close
document.addEventListener('click', (e) => {
    const inside = (e.target as HTMLElement).closest('.dropdown') || (e.target as HTMLElement).closest('.menu') || (e.target as HTMLElement).closest('.nav-toggle');
    if (!inside) closeAll();
});

// close on ESC
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeAll();
});

const menuBtn = document.getElementById('menuBtn');
const mobileMenu = document.getElementById('mobileMenu');

if (menuBtn && mobileMenu) {
    menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });
}
</script>
<style>
     /* =========================================================
     1) Header / Nav (기존 CSS 네비 버전 유지)
  ========================================================= */
  .site-header{
    position:sticky;
    top:0;
    background:rgba(252,252,252,.9);
    backdrop-filter:blur(8px);
    border-bottom:1px solid #e2e5eb;
    z-index:10;
  }
  
  .nav{
    display:flex;
    align-items:center;
    justify-content:space-between;
    min-height:64px;
  }
  
  .brand{
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:700;
  }
  
  .logo{ width:28px; height:28px; }
  
  /* top-level menu */
  .menu > ul{
    list-style:none;
    margin:0;
    padding:0;
    display:flex;
    gap:22px;
    align-items:center;
  }
  .menu a{ opacity:.95; }
  .menu a:hover{ opacity:1; }
  
  /* Dropdowns (click-to-open only) */
  .dropdown{ position:relative; }
  .dropbtn{
    background:none;
    border:0;
    color:var(--fg);
    font:inherit;
    cursor:pointer;
  }
  .dropbtn, .menu a{ color:var(--fg); }
  
  .dropdown-menu{
    position:absolute;
    top:120%;
    left:0;
    background:#ffffff;
    border:1px solid #e2e5eb;
    border-radius:10px;
    min-width:220px;
    box-shadow:0 10px 30px rgba(15,23,42,.12);
    padding:0;
    margin:0;
    display:block; /* vertical stack */
  }
  
  .dropdown-menu[hidden]{ display:none !important; }
  .dropdown-menu li{ list-style:none; display:block; }
  .dropdown-menu a{
    display:block;
    padding:10px 14px;
    border-bottom:1px solid #e2e5eb;
    white-space:nowrap;
  }
  .dropdown-menu a:last-child{ border-bottom:0; }
  
  /* Mobile nav */
  .nav-toggle{
    display:none;
    background:none;
    border:1px solid #cbd5e1;
    border-radius:8px;
    padding:6px 10px;
    color:var(--fg);
  }
  
  @media (max-width:820px){
    .nav-toggle{ display:inline-block; }
    .menu{
      display:none;
      position:absolute;
      right:16px;
      top:64px;
      background:#ffffff;
      padding:12px;
      border:1px solid #e2e5eb;
      border-radius:12px;
    }
    .menu > ul{ flex-direction:column; align-items:stretch; gap:6px; }
    .dropdown .dropdown-menu{
      position:relative;
      top:auto; left:auto;
      margin-top:6px;
    }
  }
  
</style>